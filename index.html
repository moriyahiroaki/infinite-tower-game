<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Infinite Tower: Omni-Transit Alchemy</title>
<style>
    :root {
        --bg: #0d0d0f; --panel: #1c1c21; --text: #e0e0e0;
        --iron: #e74c3c; --lead: #9b59b6; --copper: #2ecc71;
        --gold: #f1c40f; --silver: #3498db; --platinum: #ecf0f1;
    }
    body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
    
    /* Header & RCI */
    #header { background: #000; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #333; }
    .rci-bar { display: flex; gap: 10px; }
    .rci-node { padding: 4px 10px; border-radius: 4px; font-weight: bold; font-size: 13px; }
    .r-node { background: #27ae60; } .c-node { background: #2980b9; } .i-node { background: #f39c12; color: #000; }

    /* Layout */
    #main { display: flex; flex: 1; overflow: hidden; }
    
    /* Tower & Multi-Shaft Area */
    #tower-section { flex: 1.5; position: relative; background: #111; display: flex; overflow: hidden; border-right: 2px solid #333; }
    #shaft-container { width: 140px; height: 100%; background: rgba(0,0,0,0.3); display: flex; gap: 2px; padding: 0 5px; border-right: 1px solid #333; z-index: 2; }
    .shaft { width: 16px; height: 100%; position: relative; border-right: 1px solid #222; }
    .ele-car { position: absolute; width: 12px; height: 30px; left: 2px; border-radius: 2px; transition: bottom 0.5s ease-in-out; box-shadow: 0 0 10px currentColor; z-index: 3; }

    #sky { flex: 1; overflow-y: auto; display: flex; flex-direction: column-reverse; padding: 20px; padding-left: 10px; }
    .floor { height: 40px; border: 1px solid #333; margin: 1px 0; background: #222; font-size: 11px; display: flex; align-items: center; justify-content: center; transition: 0.3s; flex-shrink: 0; }
    
    /* Alchemy Colors */
    .c2-alloy { background: linear-gradient(45deg, var(--iron), var(--lead)); }
    .c3-zenith { background: conic-gradient(var(--iron), var(--lead), var(--copper), var(--gold), var(--silver), var(--platinum), var(--iron)); animation: rotate 5s linear infinite; }
    @keyframes rotate { from { filter: hue-rotate(0deg); } to { filter: hue-rotate(360deg); } }

    /* Dashboard */
    #dashboard { flex: 1.2; background: var(--panel); display: flex; flex-direction: column; }
    .tabs { display: flex; background: #000; }
    .tab { flex: 1; padding: 12px; cursor: pointer; text-align: center; font-size: 11px; border-bottom: 2px solid transparent; }
    .tab.active { border-bottom: 2px solid var(--gold); background: #222; }
    .panel { display: none; padding: 15px; overflow-y: auto; flex: 1; }
    .panel.active { display: block; }

    .card { background: #2a2a32; padding: 12px; margin-bottom: 10px; border-radius: 4px; border-left: 4px solid #444; }
    button { width: 100%; padding: 8px; cursor: pointer; background: #444; color: #fff; border: none; border-radius: 3px; font-weight: bold; margin-top: 5px; }
    button:hover { background: #555; }
    
    #grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 4px; }
    .gem { aspect-ratio: 1; border-radius: 4px; cursor: pointer; border: 1px solid rgba(255,255,255,0.1); transition: 0.1s; }
    .gem:active { transform: scale(0.9); }
</style>
</head>
<body>

<div id="header">
    <div style="font-weight:bold; letter-spacing:1px;">ZENITH TOWER OS</div>
    <div class="rci-bar">
        <div class="rci-node r-node">R: <span id="val-r">0</span></div>
        <div class="rci-node c-node">C: <span id="val-c">0</span></div>
        <div class="rci-node i-node">I: <span id="val-i">0</span></div>
    </div>
    <button onclick="saveGame()" style="width:auto; font-size:10px;">SAVE JSON</button>
</div>

<div id="main">
    <div id="tower-section">
        <div id="shaft-container"></div>
        <div id="sky"></div>
    </div>

    <div id="dashboard">
        <div class="tabs">
            <div class="tab active" onclick="showTab('transit')">TRANSIT</div>
            <div class="tab" onclick="showTab('build')">BUILD</div>
            <div class="tab" onclick="showTab('alchemy')">ALCHEMY</div>
        </div>

        <div id="tab-transit" class="panel active">
            <h3>Transit Network</h3>
            <div id="elevator-list"></div>
        </div>

        <div id="tab-build" class="panel">
            <h3>Architecture</h3>
            <div class="card">
                <strong>Standard Floor</strong>
                <button onclick="buildFloor('std')">Build (10 Iron)</button>
            </div>
            <div class="card" style="border-left-color: var(--platinum)">
                <strong>Zenith Core (3-Color)</strong>
                <button onclick="buildFloor('zenith')">Build (100 All)</button>
            </div>
        </div>

        <div id="tab-alchemy" class="panel">
            <h3>Resource Extraction</h3>
            <div id="res-display" style="display:grid; grid-template-columns:1fr 1fr; gap:5px; margin-bottom:15px; font-size:12px;"></div>
            <div id="grid"></div>
        </div>
    </div>
</div>

<script>
    // エレベーター定義：君の指定した停車間隔と速度序列
    const TIERS = {
        LOCAL:         { name: "Local", interval: 1, speed: 2.0, color: '#00ff00', cost: { iron: 10 } },
        SEMI_EXP:      { name: "Semi Express", interval: 2, speed: 1.5, color: '#00ffff', cost: { iron: 30, lead: 30 } },
        EXPRESS:       { name: "Express", interval: 5, speed: 1.2, color: '#ffff00', cost: { iron: 100, copper: 100 } },
        RAPID_EXP:     { name: "Rapid Express", interval: 10, speed: 1.0, color: '#ffaa00', cost: { gold: 200, silver: 200 } },
        LIMITED_EXP:   { name: "Limited Express", interval: 15, speed: 0.8, color: '#ff3e3e', cost: { gold: 500, platinum: 500 } },
        RAPID_LIMITED: { name: "Rapid Limited Express", interval: 30, speed: 0.5, color: '#ff00ff', cost: { silver: 1000, platinum: 1000, copper: 1000 } },
        SUPER_EXP:     { name: "Super Express", interval: 100, speed: 0.2, color: '#ffffff', cost: { iron: 5000, platinum: 5000, gold: 5000 } }
    };

    const COLORS = { iron: '#ff3e3e', lead: '#bf5af2', copper: '#32d74b', gold: '#ffd60a', silver: '#0a84ff', platinum: '#f2f2f7' };

    let state = {
        res: { iron: 100, lead: 100, copper: 100, gold: 100, silver: 100, platinum: 100 },
        floors: [],
        unlockedTiers: ['LOCAL'],
        rci: { r: 10, c: 10, i: 10 }
    };

    function init() {
        for(let i=0; i<10; i++) state.floors.push({type:'std'});
        renderAll();
        setInterval(simulateTraffic, 2000);
    }

    function renderAll() {
        renderRes();
        renderGrid();
        renderTower();
        renderElevatorUI();
        updateRCI();
    }

    function renderRes() {
        const d = document.getElementById('res-display');
        d.innerHTML = '';
        for(let k in state.res) {
            d.innerHTML += `<div style="color:${COLORS[k]}">${k.toUpperCase()}: ${Math.floor(state.res[k])}</div>`;
        }
    }

    function renderGrid() {
        const g = document.getElementById('grid');
        g.innerHTML = '';
        const keys = Object.keys(COLORS);
        for(let i=0; i<30; i++) {
            let type = keys[Math.floor(Math.random()*6)];
            let gem = document.createElement('div');
            gem.className = 'gem';
            gem.style.backgroundColor = COLORS[type];
            gem.onclick = () => { state.res[type] += 10 * (state.rci.i/10); renderRes(); renderGrid(); };
            g.appendChild(gem);
        }
    }

    function renderTower() {
        const sky = document.getElementById('sky');
        sky.innerHTML = '';
        state.floors.forEach((f, i) => {
            let div = document.createElement('div');
            div.className = `floor ${f.type === 'zenith' ? 'c3-zenith' : ''}`;
            div.innerText = `F${i} - ${f.type.toUpperCase()}`;
            sky.appendChild(div);
        });

        const shafts = document.getElementById('shaft-container');
        shafts.innerHTML = '';
        state.unlockedTiers.forEach(t => {
            let s = document.createElement('div');
            s.className = 'shaft';
            s.innerHTML = `<div id="car-${t}" class="ele-car" style="color:${TIERS[t].color}; background:currentColor;"></div>`;
            shafts.appendChild(s);
        });
    }

    function renderElevatorUI() {
        const list = document.getElementById('elevator-list');
        list.innerHTML = '';
        for(let key in TIERS) {
            let t = TIERS[key];
            let unlocked = state.unlockedTiers.includes(key);
            list.innerHTML += `
                <div class="card" style="border-left-color:${t.color}">
                    <strong>${t.name}</strong><br>
                    <small>Interval: ${t.interval}F | Spd: ${t.speed}s</small>
                    <button onclick="unlockEle('${key}')" ${unlocked ? 'disabled' : ''}>
                        ${unlocked ? 'OPERATIONAL' : 'Unlock'}
                    </button>
                </div>`;
        }
    }

    function unlockEle(key) {
        let cost = TIERS[key].cost;
        for(let k in cost) if((state.res[k]||0) < cost[k]) return alert("Missing resources!");
        for(let k in cost) state.res[k] -= cost[k];
        state.unlockedTiers.push(key);
        renderAll();
    }

    function buildFloor(type) {
        state.floors.push({type: type});
        if(type === 'zenith') state.rci.r += 50; else state.rci.i += 2;
        renderTower(); updateRCI();
    }

    function simulateTraffic() {
        state.unlockedTiers.forEach(t => {
            const car = document.getElementById(`car-${t}`);
            if(!car) return;
            let possible = [];
            for(let i=0; i<state.floors.length; i++) if(i % TIERS[t].interval === 0) possible.push(i);
            let target = possible[Math.floor(Math.random()*possible.length)];
            car.style.transition = `bottom ${TIERS[t].speed}s ease-in-out`;
            car.style.bottom = (target * 42) + 'px';
        });
    }

    function updateRCI() {
        document.getElementById('val-r').innerText = state.rci.r;
        document.getElementById('val-c').innerText = state.rci.c;
        document.getElementById('val-i').innerText = state.rci.i;
    }

    function showTab(id) {
        document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById('tab-'+id).classList.add('active');
        event.currentTarget.classList.add('active');
    }

    function saveGame() {
        const data = encodeURIComponent(JSON.stringify(state));
        const a = document.createElement('a');
        a.href = "data:text/json;charset=utf-8," + data;
        a.download = "tower_zenith_save.json"; a.click();
    }

    init();
</script>
</body>
</html>
