<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Infinite Tower: Zenith Alchemy</title>
<style>
    :root {
        --bg: #0d0d0f; --panel: #1c1c21; --text: #e0e0e0;
        --ruby: #ff3e3e; --amethyst: #bf5af2; --emerald: #32d74b;
        --topaz: #ffd60a; --sapphire: #0a84ff; --diamond: #f2f2f7;
    }
    body { font-family: 'Courier New', monospace; background: var(--bg); color: var(--text); margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
    
    /* Header & RCI Map Synergy */
    #header { background: #000; padding: 10px; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #333; }
    .rci-bar { display: flex; gap: 10px; }
    .rci-node { padding: 5px 10px; border-radius: 4px; font-weight: bold; font-size: 14px; }
    .r-node { background: #1a5c2e; } .c-node { background: #1a3c5c; } .i-node { background: #5c3c1a; }

    /* Layout */
    #main { display: flex; flex: 1; overflow: hidden; }
    
    /* Tower & Elevator Area */
    #tower-area { flex: 1.5; position: relative; display: flex; background: #111; border-right: 2px solid #333; overflow-y: auto; flex-direction: column-reverse; padding: 50px; }
    .floor { 
        height: 50px; margin: 2px 0; border: 1px solid #444; position: relative; 
        display: flex; align-items: center; justify-content: center; font-weight: bold; transition: 0.3s;
    }
    .elevator-shaft { position: absolute; left: 10px; top: 0; bottom: 0; width: 30px; background: #222; border: 1px solid #444; }
    .elevator-car { position: absolute; left: 2px; width: 24px; height: 40px; background: #00ff00; box-shadow: 0 0 10px #00ff00; transition: top 0.5s ease-in-out; }
    .express-car { background: #00ffff; box-shadow: 0 0 15px #00ffff; height: 30px; }

    /* Dashboard */
    #dashboard { flex: 1.2; display: flex; flex-direction: column; background: var(--panel); }
    .tabs { display: flex; background: #000; }
    .tab { flex: 1; padding: 15px; cursor: pointer; text-align: center; border-bottom: 2px solid transparent; }
    .tab.active { border-bottom: 2px solid var(--topaz); background: #222; }

    /* Puzzle & Magic Cards */
    #puzzle-container { padding: 20px; display: flex; flex-direction: column; align-items: center; }
    #grid { display: grid; grid-template-columns: repeat(6, 50px); gap: 5px; }
    .gem { width: 50px; height: 50px; border-radius: 8px; cursor: pointer; border: 1px solid rgba(255,255,255,0.1); }
    .magic-area { display: flex; gap: 10px; margin-top: 20px; flex-wrap: wrap; }
    .magic-btn { padding: 8px; font-size: 11px; background: #333; color: #fff; cursor: pointer; border: 1px solid #666; }

    /* Hybrid Color Classes */
    .c2-iron-lead { background: linear-gradient(45deg, var(--ruby), var(--amethyst)); }
    .c3-zenith { background: conic-gradient(var(--ruby), var(--amethyst), var(--emerald), var(--topaz), var(--sapphire), var(--diamond), var(--ruby)); animation: rotate 5s linear infinite; }
    @keyframes rotate { from { filter: hue-rotate(0deg); } to { filter: hue-rotate(360deg); } }

    .res-val { font-size: 12px; margin-bottom: 5px; }
</style>
</head>
<body>

<div id="header">
    <div id="title">ZENITH TOWER OS</div>
    <div class="rci-bar">
        <div class="rci-node r-node">Res: <span id="r-val">10</span></div>
        <div class="rci-node c-node">Com: <span id="c-val">10</span></div>
        <div class="rci-node i-node">Ind: <span id="i-val">10</span></div>
    </div>
    <div>
        <button onclick="saveGame()">SAVE JSON</button>
    </div>
</div>

<div id="main">
    <div id="tower-area">
        <div class="elevator-shaft">
            <div id="ele-car" class="elevator-car"></div>
            <div id="exp-car" class="elevator-car express-car" style="display:none;"></div>
        </div>
        <div id="floors-container"></div>
    </div>

    <div id="dashboard">
        <div class="tabs">
            <div class="tab active" onclick="showTab('puzzle')">Alchemy</div>
            <div class="tab" onclick="showTab('build')">Architecture</div>
            <div class="tab" onclick="showTab('map')">SimMap</div>
        </div>

        <div id="tab-puzzle" style="display:block; padding:15px;">
            <div id="res-display" style="display:grid; grid-template-columns: 1fr 1fr; gap:5px; margin-bottom:15px;"></div>
            <div id="grid"></div>
            <div class="magic-area">
                <button class="magic-btn" onclick="useMagic('flame')">Flame Craft (Red)</button>
                <button class="magic-btn" onclick="useMagic('shield')">Dream Barrier (White)</button>
                <button class="magic-btn" onclick="useMagic('haste')">Express Mode (Blue)</button>
            </div>
        </div>

        <div id="tab-build" style="display:none; padding:15px;">
            <h3>Construct Hybrid Floor</h3>
            <button onclick="construct('iron', 'lead')">Build Iron-Lead Alloy (2-Color)</button>
            <button onclick="construct('zenith')">Build ZENITH CORE (3+ Color)</button>
            <hr>
            <h3>Vertical Transport</h3>
            <button onclick="upgradeElevator('normal')">Install Express Elevator</button>
        </div>

        <div id="tab-map" style="display:none; padding:15px;">
            <h3>City-Tower Synergy</h3>
            <p>Adjacent Park: R+20%</p>
            <p>Adjacent Industrial Zone: I+30%</p>
            <div id="sim-map" style="width:100%; height:200px; background:#000; border:1px dashed #555;">
                [Map Grid Simulation Rendering...]
            </div>
        </div>
    </div>
</div>

<script>
    let state = {
        res: { iron: 100, lead: 100, copper: 100, gold: 100, silver: 100, platinum: 100 },
        floors: [],
        elePos: 0,
        hasExpress: false,
        rci: { r:10, c:10, i:10 }
    };

    const COLORS = {
        iron: '#ff3e3e', lead: '#bf5af2', copper: '#32d74b',
        gold: '#ffd60a', silver: '#0a84ff', platinum: '#f2f2f7'
    };

    function init() {
        renderRes();
        renderPuzzle();
        setInterval(moveElevator, 2000);
    }

    function renderRes() {
        const container = document.getElementById('res-display');
        container.innerHTML = '';
        for(let key in state.res) {
            container.innerHTML += `<div class="res-val" style="color:${COLORS[key]}">${key.toUpperCase()}: ${Math.floor(state.res[key])}</div>`;
        }
    }

    function renderPuzzle() {
        const grid = document.getElementById('grid');
        grid.innerHTML = '';
        for(let i=0; i<36; i++) {
            let keys = Object.keys(COLORS);
            let color = keys[Math.floor(Math.random()*6)];
            let div = document.createElement('div');
            div.className = 'gem';
            div.style.backgroundColor = COLORS[color];
            div.onclick = () => {
                state.res[color] += 10 * (state.rci.i/10);
                renderRes();
                renderPuzzle();
            };
            grid.appendChild(div);
        }
    }

    function construct(c1, c2) {
        let type = c2 ? `c2-${c1}-${c2}` : `c3-zenith`;
        let floor = { type: type, level: 1 };
        state.floors.push(floor);
        renderTower();
        state.rci.i += 5; updateRCI();
    }

    function renderTower() {
        const cont = document.getElementById('floors-container');
        cont.innerHTML = '';
        state.floors.forEach(f => {
            let div = document.createElement('div');
            div.className = `floor ${f.type}`;
            div.innerText = f.type.toUpperCase();
            cont.appendChild(div);
        });
    }

    function moveElevator() {
        if(state.floors.length === 0) return;
        let car = document.getElementById('ele-car');
        let target = Math.floor(Math.random() * state.floors.length);
        car.style.bottom = (target * 52) + 'px';
    }

    function showTab(name) {
        document.querySelectorAll('.panel, [id^="tab-"]').forEach(el => el.style.display = 'none');
        document.getElementById('tab-'+name).style.display = 'block';
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    }

    function updateRCI() {
        document.getElementById('r-val').innerText = state.rci.r;
        document.getElementById('c-val').innerText = state.rci.c;
        document.getElementById('i-val').innerText = state.rci.i;
    }

    function useMagic(type) {
        alert("Magic Triggered: " + type.toUpperCase());
        // Add specific magic logic here
    }

    function saveGame() {
        const blob = new Blob([JSON.stringify(state)], {type: 'application/json'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = 'tower_save.json'; a.click();
    }

    init();
</script>
</body>
</html>
